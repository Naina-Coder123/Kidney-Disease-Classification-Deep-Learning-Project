<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>cnncls</title>

   

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

	<style>
    body{
        background: linear-gradient(135deg, #e8f5e9, #f1f8ff);
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    }

    .iupload h3{
        color:#0b3c5d;
        font-size:32px;
        font-weight:700;
        letter-spacing:0.5px;
    }

    .img-part{
        height:320px;
        width:320px;
        margin:0 auto;
    }

    .image-part{
        height:320px;
        width:320px;
        border:2px dashed #0b3c5d;
        border-radius:10px;
        background:#ffffff;
        display:flex;
        align-items:center;
        justify-content:center;
    }

    .image-part img{
        height:100%;
        width:100%;
        object-fit:cover;
        display:none;
        padding:6px;
        border-radius:10px;
    }

    .image-part #video{
        height:100%;
        width:100%;
        border-radius:10px;
    }

    .btn-part{
        width:100%;
        margin-top:15px;
        text-align:center;
    }

    .btn-primary{
        background-color:#0b3c5d;
        border:none;
    }

    .btn-primary:hover{
        background-color:#145a86;
    }

    .btn-success{
        background-color:#2e7d32;
        border:none;
    }

    .btn-success:hover{
        background-color:#1b5e20;
    }

    .right-part{
        background:#ffffff;
        border-radius:10px;
        box-shadow:0 4px 15px rgba(0,0,0,0.1);
        padding:15px;
    }

    .res-part,
    .res-part2{
        border:1px solid #dcdcdc;
        border-radius:8px;
        height:300px;
        padding:10px;
        background:#fafafa;
        overflow:auto;
    }

    .res-part pre{
        font-size:15px;
        color:#263238;
    }

    .resp-img{
        height:100%;
        width:100%;
        object-fit:contain;
        border-radius:8px;
    }

    #loading{
        position:fixed;
        left:0;
        top:0;
        width:100%;
        height:100%;
        z-index:9999;
        background:rgba(255,255,255,0.8);
        display:flex;
        align-items:center;
        justify-content:center;
    }

    .loader{
        border:6px solid #e0e0e0;
        border-top:6px solid #0b3c5d;
        border-radius:50%;
        width:55px;
        height:55px;
        animation:spin 1s linear infinite;
    }

    @keyframes spin{
        0%{transform:rotate(0deg);}
        100%{transform:rotate(360deg);}
    }
</style>

</head>

<body>
    <div class="main container">
		<section class="iupload">
			<h3 class="text-center py-4">Object Classification</h3>
			<div class="row">
				<div class="img-part col-md-6">
					<div class="image-part">
						<video autoplay id="video"></video>
						<img src="" id="photo">
						<canvas style="display:none;" id="canvas"></canvas>
					</div>
					<div class="btn-part">
						<form id="upload-data pt-3">
							<div class="input-group mt-3 row">
								<button type="button" class="btn btn-primary col-md-5 ml-3 mr-4" id="uload">Upload</button>
								<button id="send" type="button" class="btn btn-success col-md-5">Predict</button>
							</div>

							<input type="hidden" id="url" value="../predict"/>
							<input name="upload" type="file" id="fileinput" style="position:absolute;top:-500px;"/>
						</form>
					</div>
				</div>

				<div class="col-md-6 right-part">
					<h5 class="mb-2"><center>Prediction Results</center></h5>
					<div class="row">
						<div class="res-part2 col-md-5"></div>
						<div class="res-part col-md-5"><div class="jsonRes"></div></div>
					</div>
				</div>
			</div>
		</section>
	</div>

   

<div id="loading"><div class="loader"></div></div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<script>
var base_data = "";

function sendRequest(base64Data){
	var url = $("#url").val();
	$("#loading").show();
	$.ajax({
		url : url,
		type: "post",
		headers: {'Content-Type': 'application/json'},
		data:JSON.stringify({image:base64Data}),
		success: function(res){
        $(".res-part").html("<pre>" + JSON.stringify(res[0], undefined, 2) + "</pre>");
        $(".res-part2").html("<img class='resp-img' src='" + $('#photo').attr('src') + "' />");
        $("#loading").hide();
}
	});
}

$(document).ready(function(){
	$("#loading").hide();

	$('#send').click(function(){ sendRequest(base_data); });

	$('#uload').click(function(){ $('#fileinput').click(); });

	$("#fileinput").change(function(){
		var reader = new FileReader();
		reader.onload = function (e){
			var img = new Image();
			img.onload = function(){
				var canvas = document.createElement('CANVAS');
				canvas.height = this.height;
				canvas.width = this.width;
				canvas.getContext('2d').drawImage(this, 0, 0);
				base_data = canvas.toDataURL('image/jpeg', 1.0)
					.replace(/^data:image.+;base64,/, '');
			};
			img.src = e.target.result;
			$('#photo').attr('src', e.target.result).show();
			$('#video').hide();
		}
		reader.readAsDataURL(this.files[0]);
	});
});
</script>

</body>
</html>
